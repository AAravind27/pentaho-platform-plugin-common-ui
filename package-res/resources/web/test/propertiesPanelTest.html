<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:pho="http:/www.pentaho.com">
<head>
  <title>Button Test</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <link rel="stylesheet" type="text/css" href="../dojo/dijit/themes/pentaho/pentaho.css"/>

  <link rel="stylesheet" type="text/css" href="../dojo/dijit/themes/claro/claro.css"/>

  <script type="text/javascript" src="webcontext.js?content=common-ui"></script>

  <script type="text/javascript">
    //<![CDATA[

    $.extend(djConfig,
        { modulePaths: {
          'pentaho.common': "../pentaho/common"
        },
          parseOnLoad: true,
          baseUrl: '../dojo/dojo/'

        });
    //]]>
  </script>
  <style>
    .propPanel_gemBar{
      height: 25px;
      width: 100%;
      border: 1px solid blue;
      background-color: #FFFFCC;
    }
    .pentahoPropertiesPanel{
      border: 1px solid #666;
      background-color: #d3d3d3;
    }
    .pentahoPropertiesPanel .caption{

    }
    .pentahoPropertiesPanel .caption-text{
      font-size: 12px;
      font-weight: 600;
    }

    .pentahoPropertiesPanel>*{
      margin-bottom : 8px;
    }
    .dijitTitlePaneContentInner>div>*:nth-child(2n){
      margin-bottom: 8px;
    }
    .gem{
      border-radius: 5px;
      /* Firefox */
      -moz-border-radius: 5px;
      /* Safari/Chrome */
      -webkit-border-radius: 5px;
      border: 1px solid blue;
      background-color: skyblue;
      height: 16px;
      margin: 1px;
      padding: 2px;
      display:inline-block;
    }

  </style>


  <script language='javascript' type='text/javascript' src='../dojo/dojo/dojo-all.js.uncompressed.js'></script>
  <script language='javascript' type='text/javascript' src='../dojo/pentaho/common/propertiesPanel/Configuration.js'></script>
  <script language='javascript' type='text/javascript' src='../dojo/pentaho/common/propertiesPanel/Panel.js'></script>
  <!--script language='javascript' type='text/javascript' src='../dojo/pentaho/common/propertiesPanel/Panel.js'></script-->


  <script type="text/javascript">

    dojo.require("dojo.parser");
    dojo.require("pentaho.common.propertiesPanel.Panel");
    dojo.require("pentaho.common.propertiesPanel.Configuration");
    dojo.require("dojo.dnd.Source");

  </script>

</head>

<body class="claro body" onload="doload()">

<div dojoType="pentaho.common.propertiesPanel.Panel" id="panel" style="border: 1px solid grey; width:20%; height:100%;position: absolute; left: 0px; top: 0px; padding: 4px">

</div>

<div style="float:right; width: 77%; text-align:center;padding: 20px">

  <script type="text/javascript">


    function changeConfiguration(){

      var propertiesPanel = dijit.byId('panel');

      var configJson = eval("("+dojo.byId('testJSON').value+")");
      var config = new pentaho.common.propertiesPanel.Configuration(configJson);

      propertiesPanel.setConfiguration(config);

      dojo.connect(config, "onPropertyChange", function(item, propName, prevVal, newVal){

        var output = dojo.byId("output");
        output.innerHTML = "received property change for: "+item.id+"\n"+
            "\tevent property:\t"+propName+"\n\told value:\t"+prevVal+"\n\tnew value:\t"+ newVal+"\n\n" + output.innerHTML;
        output.scrollTop = output.scrollHeight;


        // disable/enable item
        if(item.id == "testCheckbox" && propName == "value"){
          propertiesPanel.set('disabled', 'testTextbox', !newVal);
        }
      });

    };

    var disabledState = false;
    function disable(){
      var propertiesPanel = dijit.byId('panel');
      disabledState = !disabledState;
      propertiesPanel.set('disabled', "testCombo", disabledState);
      propertiesPanel.set('disabled', "testSlider", disabledState);
      propertiesPanel.set('disabled', "testTextbox", disabledState);
      propertiesPanel.set('disabled', "testCheckbox", disabledState);
    }

    function ramdomValues(){
      var propertiesPanel = dijit.byId('panel');

      var comboVals = propertiesPanel.configuration.byId('testCombo').values;

      propertiesPanel.set('value', "testCombo", comboVals[Math.round(Math.random() * comboVals.length)]);
      propertiesPanel.set('value', "testSlider", Math.random() * 100);
      propertiesPanel.set('value', "testTextbox", Math.random());
      propertiesPanel.set('value', "testCheckbox", !propertiesPanel.configuration.byId("testCheckbox").value);
    }



    dojo.declare("GemBarUISource", [dojo.dnd.Source],{

      creator: function (item, hint) {

        var gem = this.createGemFromNode(item);
        var ui = this.createGemUI(gem);
        return { node: ui.domNode, data: gem };
      },
      copyOnly: true,

      createGemFromNode:function (sourceNode) {
        return new pentaho.common.propertiesPanel.Configuration.registeredTypes["gem"]({id: sourceNode.innerHTML});
      },
      createGemUI:function (gem) {
        return new pentaho.common.propertiesPanel.GemUI(gem, this.className);
      },
    });

  </script>
  JSON:<br/>
  <textarea rows="20" id="testJSON" style="width:100%; display: block;" >
    [
    {   id: 'testGem',
    dataType: 'string',
    uiType: 'gemBar',
    dataStructure: 'column',
    dndType: 'gem',
    caption: 'Gem Bar',
    required: true,
    group: "testGroup2",
    groupTitle: "Grouping of Props"
    },
    {   id: 'testGem2',
    dataType: 'string',
    uiType: 'gemBar',
    dataStructure: 'column',
    dndType: 'gem',
    caption: 'Gem Bar 2',
    required: true,
    group: "testGroup2",
    groupTitle: "Grouping of Props"
    },
    {
    id: 'testCombo',
    caption: "Combo Box",
    dataType: 'string',
    uiType: 'combo',
    values: ["foo", "bar", "baz"],
    value: "bar",
    group: "testGroup2"
    },
    {
    id: 'testSlider',
    caption: "Slider",
    dataType: 'number',
    uiType: 'slider',
    value: 35,
    group: "testGroup2"
    },
    {
    id: 'testCheckbox',
    caption: "Checkbox",
    label: "working?",
    dataType: 'boolean',
    uiType: 'checkbox',
    value: false,
    group: "testGroup",
    groupTitle: "Test Group"
    },
    {
    id: 'testTextbox',
    caption: "Text",
    dataType: 'string',
    uiType: 'textbox',
    value: "default",
    group: "testGroup",
    disabled: true
    }

    ]
  </textarea>
  <button onClick="changeConfiguration()" style="margin: auto; ">Parse</button><br/><br/>
  Events:<br/>
  <div style="border: 1px solid black; width: 100%; height: 200px; overflow-y: auto;text-align:left">
    <pre id="output"/>
  </div>
  <button style="display: block" onClick="disable()">Toggle Disable</button>
  <button style="display: block" onClick="ramdomValues()">Random Vals</button>
  <div style="width:100%; clear:both" dojoType="dojo.dnd.Source" >
    <span style="width: 100px; height: 20px; border: 1px solid black" dndType="gem" class="dojoDndItem" id="sourceNode">Test1</span>
  </div>
  <div style="background-color:#FFFFCC; height: 40px; width: 100%" dojoType="GemBarUISource" accept="gem"></div>
</div>
</body>

</html>
